<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>发布房源</title>
    <link rel="icon" href="../../resources/images/favicon.ico"/>
    <!--先引入vue.js库-->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!--axios-->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="../js/jquery-2.1.3.js"></script>
    <!--穿梭框的layui样式库-->
    <!--<link rel="stylesheet" href="../layui/css/layui.css" >-->
    <style>
        .avatar-uploader .el-upload {
            border: 1px dashed #d9d9d9;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .avatar-uploader .el-upload:hover {
            border-color: #409EFF;
        }
        .avatar-uploader-icon {
            font-size: 28px;
            color: #8c939d;
            width: 178px;
            height: 178px;
            line-height: 178px;
            text-align: center;
        }
        .avatar {
            width: 178px;
            height: 178px;
            display: block;
        }
        .el-form-item__content {
            line-height: 40px;
            position: relative;
            font-size: 14px;
            width: 200px;
        }
        /* 设置穿梭框的 宽高 */
        .el-transfer-panel{
            width : 350px;
            height: 400px;
        }
        .el-transfer-panel__list {
            margin: 0;
            padding: 6px 0;
            list-style: none;
            height: 390px;
            overflow: auto;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }
        .el-transfer__buttons {
            display: inline-block;
            vertical-align: middle;
            padding: 0 30px;
        }
        .el-form-item__label {
            text-align: right;
            vertical-align: middle;
            float: left;
            font-size: 14px;
            color: #606266;
            line-height: 40px;
            padding: 0 12px 0 0;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 30px;
        }
        .div1{
            margin-top: 70px;
            margin-left: 100px;
        }

    </style>
</head>
<body>
<!--<script src="../layui/layui.js" charset="utf-8"></script>-->


<div id="app" class="div1">

<el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm">

    <!--<el-form-item label="房屋编号" type="hidden" prop="houseid">-->
        <el-input  v-model="ruleForm.houseid" type="hidden"  readonly="readonly"></el-input>
    <!--</el-form-item>-->

    <el-form :inline="true" :model="ruleForm" class="demo-form-inline" margin-left="30px">
        <!--<el-col :span="8">-->
            <el-form-item label="房屋描述" prop="htitle">
                <el-input  v-model="ruleForm.htitle"placeholder="如:某小区，几室几厅"></el-input>
            </el-form-item>
        <!--</el-col>-->
        <!--<el-col :span="8">-->
            <el-form-item label="房屋楼层" prop="hfloor">
                <el-input v-model="ruleForm.hfloor"></el-input>
            </el-form-item>
        <!--</el-col>-->
        <!--<el-col :span="8">-->
            <el-form-item label="设定租金" prop="hrent">
                <el-input v-model="ruleForm.hrent"></el-input>
            </el-form-item>
        <!--</el-col>-->
    </el-form>

    <!--第二行-->
    <el-form :inline="true" :model="ruleForm" class="demo-form-inline" margin-left="30px">
        <!--<el-col :span="8">-->
        <el-form-item label="详细地址" prop="hadr">
            <!--详细地址：应该做一个级联-->
            <el-input  v-model="ruleForm.hadr"placeholder="如:区名，某小区"></el-input>
        </el-form-item>
        <!--</el-col>-->
        <!--尝试级联-->
        <!--<el-form-item label="详细地址" prop="hadr">-->
            <!--<el-cascader-->
                    <!--v-model="ruleForm.hadr"-->
                    <!--:options="options"-->
                    <!--@change="handleChange"></el-cascader>-->
        <!--</el-form-item>-->
        <!--<el-col :span="8">-->
        <el-form-item label="占地面积" prop="harea">
            <el-input v-model="ruleForm.harea"></el-input>
        </el-form-item>
        <!--</el-col>-->

        <!--<el-col :span="8">-->
        <el-form-item label="房屋朝向" prop="orientation">
            <el-input v-model="ruleForm.orientation" placeholder="如:坐北朝南"></el-input>
        </el-form-item>
        <!--</el-col>-->

    </el-form>
    <!--房东编号，应该是在跳转页面后直接显示出来的-->
    <!--房东姓名，应该是在跳转页面后直接显示出来的-->

    <el-form :inline="true" :model="ruleForm" class="demo-form-inline" margin-left="30px">
        <!--<el-col :span="8">-->
            <el-form-item label="发布日期" :label-width="formLabelWidth">
                <el-date-picker
                        v-model="ruleForm.releasedate"
                        align="right"
                        type="date"
                        placeholder="选择日期"
                        :picker-options="pickerOptions" >
                </el-date-picker>
            </el-form-item>
        <!--</el-col>-->

        <!--<el-col :span="8">-->
        <!--上传房屋图片-->
        <el-form-item label="房屋图片" :label-width="formLabelWidth" margin-left="30px">
            <el-upload
                    name="headPic"
                    class="avatar-uploader"
                    action="/demo4/house/uploadHeadPic"
                    :show-file-list="false"
                    :on-success="handleAvatarSuccess"
                    :before-upload="beforeAvatarUpload">
                <img v-if="imageUrl" :src="imageUrl" class="avatar">
                <i v-else class="el-icon-plus avatar-uploader-icon"></i>
            </el-upload>
        </el-form-item>
        <!--</el-col>-->

    </el-form>


    <!--配置家具:inline="true"class="demo-form-inline"-->
    <el-form :inline="true" :model="furnitureForm"  margin-left="30px"class="demo-form-inline">
        <!--<el-col :span="8">-->
        <el-form-item label="配置家具" :label-width="formLabelWidth" margin-left="30px">
            <span id="tbd" style="width: 1000px;"></span>

        </el-form-item>
    <!--</el-col>-->
    </el-form>

    <!--配置家具第2版-->
    <!--<el-form :inline="true" :model="furnitureForm" class="demo-form-inline" margin-left="30px">-->
        <!--<el-form-item label="配置家具" :label-width="formLabelWidth" margin-left="30px">-->
            <!--&lt;!&ndash;<span id="tbd" style="width: 1000px;"></span>&ndash;&gt;-->
            <!--<template>-->
                <!--<el-checkbox :indeterminate="isIndeterminate" v-model="checkAll" @change="handleCheckAllChange">全选</el-checkbox>-->
                <!--<div style="margin: 15px 0;"></div>-->
                <!--<el-checkbox-group v-model="checkedFurnitures" @change="handleCheckedFurnituresChange">-->
                    <!--<el-checkbox v-for="furniture in furnitures" :label="furniture" :key="furniture">{{city}}</el-checkbox>-->
                <!--</el-checkbox-group>-->
            <!--</template>-->

        <!--</el-form-item>-->
    <!--</el-form>-->

    <!--上传房屋图片-->
    <!--<el-form-item label="原房屋图片" v-if="ruleForm.headPicName" :label-width="formLabelWidth">-->
        <!--<img v-if="ruleForm.headPicName" :src="'/demo4/house/show?fileName='+ruleForm.headPicName" height="160px;" width="160px;">-->
    <!--</el-form-item>-->
<el-form :inline="true" :model="furnitureForm" class="demo-form-inline" margin-left="30px">
    <el-form-item>
    <el-button type="primary" @click="saveData">
        <el-button type="primary" @click="saveFurniture" style="margin:0px;padding:0px">提交</el-button>
    </el-button>
    <el-button type="primary" @click="loadData">重置</el-button>
</el-form-item>
</el-form>

</el-form>
</div>

<script>
    // 获取家具列表的异步请求
    $(function () {
        $("#tbd").empty();
        $.ajax({
            url:"/demo4/part/furnitures",
            type:"POST",
            dataType:"json",
            success:function (data) {
                var tr="<table style=\"width: 1000px;\"><tr>";
                for (var i = 0; i < data.length; i++) {
                    var item=data[i];
                    // alert(item.furnitureid);
                    tr+="<td><input type='checkbox' name='checkbox' value='"+item.furnitureid+"'/>"+item.furniturename+"</td>";
                }
                tr+="</tr></table>";
                $("#tbd").append(tr);
            }
        })
    })

    // vue的数据处理
   var vue=new Vue({
       el: "#app",
       data: {
           // value:[],
           options:[
               {value:'中原区', label: '中原区',
               children: [
                   {value: '五一公园', label: '五一公园',
                   children: [
                       {value: '西贵小区1', label: '西贵小区1'}, {value: '西贵小区2', label: '西贵小区2'}]},
                   {value: '五一公园2', label: '五一公园2',
                   children: [
                       {value: '西贵小区3', label: '西贵小区3'}, {value: '西贵小区4', label: '西贵小区4'}]}
                   ]
               },
               {value:'二七区', label: '二七区',
                   children: [
                       {value: '河医立交桥1', label: '河医立交桥1',
                           children: [
                               {value: '绿洲书苑1', label: '绿洲书苑1'}, {value: '绿洲书苑2', label: '绿洲书苑2'},
                              ]},
                       {value: '河医立交桥2', label: '河医立交桥2',
                           children: [
                               {value: '绿洲书苑3', label: '绿洲书苑3'}, {value: '绿洲书苑4', label: '绿洲书苑4'}
                              ]}
                   ]
           }],
           ruleForm: {
               houseid:'',
               htitle: '',
               hadr: '',
               // hadr:[],
               // value:[],
               // options:[
               //     {value:'中原区', label: '中原区',
               //         children: [
               //             {value: '五一公园', label: '五一公园',
               //                 children: [
               //                     {value: '西贵小区1', label: '西贵小区1'}, {value: '西贵小区2', label: '西贵小区2'}]},
               //             {value: '五一公园2', label: '五一公园2',
               //                 children: [
               //                     {value: '西贵小区3', label: '西贵小区3'}, {value: '西贵小区4', label: '西贵小区4'}]}
               //         ]
               //     },
               //     {value:'二七区', label: '二七区',
               //         children: [
               //             {value: '河医立交桥1', label: '河医立交桥1',
               //                 children: [
               //                     {value: '绿洲书苑1', label: '绿洲书苑1'}, {value: '绿洲书苑2', label: '绿洲书苑2'},
               //                 ]},
               //             {value: '河医立交桥2', label: '河医立交桥2',
               //                 children: [
               //                     {value: '绿洲书苑3', label: '绿洲书苑3'}, {value: '绿洲书苑4', label: '绿洲书苑4'}
               //                 ]}
               //         ]
               //     }],
               hrent: '',
               hfloor: '',
               harea: '',
               orientation: '',
               releasedate:'',
               // furnitures:[],
               headPic:'',
               headPicName:''
           },
           furnitureForm:{
               houseid:'',
               furnitureid:''
           },
           imageUrl:'',
           rules: {
               htitle: [
                   {required: true, message: '请输入房屋描述', trigger: 'blur'},
               ],
               hadr: [
                   {required: true, message: '请选择房屋详细地址', trigger: 'blur'}
               ],
               hrent: [
                   {required: true, message: '请设定房屋租金', trigger: 'blur'}
               ],
               harea: [
                   {required: true, message: '请描述房屋面积', trigger: 'blur'}
               ]
           },
           pickerOptions:{
               disabledDate:function(time) {
                   return time.getTime() > Date.now();
               },
               shortcuts: [{
                   text: '今天',
                   onClick:function(picker) {
                       picker.$emit('pick', new Date());
                   }
               }, {
                   text: '昨天',
                   onClick:function(picker) {
                       const date = new Date();
                       date.setTime(date.getTime() - 3600 * 1000 * 24);
                       picker.$emit('pick', date);
                   }
               }, {
                   text: '一周前',
                   onClick:function(picker) {
                       const date = new Date();
                       date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);
                       picker.$emit('pick', date);
                   }
               }]
           },

       },
       created: function () {
           this.loadData();
           var self = this;
           var Num="";
           for (var i = 0; i < 8; i++) {
               Num+=Math.floor(Math.random()*10);
           }
           self.ruleForm={id:'', houseid:Num, htitle:'', hadr:'',
               hrent:'', headPic:'',headPicName:'', hfloor:'', harea:'', orientation:'',
               releasedate:'', hdesc:''
           };
           // 向房子家具中间表中存入的数据
           self.furnitureForm={houseid:Num,furnitureid:''}
       },
       methods: {
           loadData:function(){
               var Num="";
               for (var i = 0; i < 8; i++) {
                   Num+=Math.floor(Math.random()*10);
               }
               this.ruleForm={id:'', houseid:Num, htitle:'', hadr:'',
                   hrent:'', headPic:'',headPicName:'', hfloor:'', harea:'', orientation:'',
                   releasedate:'', hdesc:''
               };
               // 向房子家具中间表中存入的数据
               this.furnitureForm={houseid:Num,furnitureid:''};

               //刷新页面时，将所有选中的复选框设为未选中状态
               var checkbox=$('input[name=\'checkbox\']:checked');
               for (var i = 0; i < checkbox.length; i++) {
                   checkbox[i].checked=false;
               }

           },
           saveData:function () {
               var self=this;
               axios.post("/demo4/house/save",this.ruleForm)
                   .then(function (response) {

                       if (response.data==1){
                           self.$message({
                               message: '恭喜你，操作成功',
                               type: 'success'
                           });
                           self.loadData();
                       }else{
                           self.$message.error('错了哦，操作失败');
                       }
                   })
               this.imageUrl='';
           },
           saveFurniture:function(){
               // var Num="";
               // for (var i = 0; i < 8; i++) {
               //     Num+=Math.floor(Math.random()*10);
               // }
               // // 向房子家具中间表中存入的数据
               // this.furnitureForm={houseid:Num,furnitureid:''}

               var self=this;
               // 写一个数组存入所有的家具编号
               var ids=[];
               $('input[name=\'checkbox\']:checked').each(function () {
                   ids.push($(this).val());
               });
               $.ajax({
                   url:"/demo4/house/saveFurniture",
                   type:"POST",
                   // contentType: 'application/json; charset=UTF-8',
                   data:{furnitures:ids.toString(),houseid:this.furnitureForm.houseid},
                   dataType:"json",
                   success:function (msg) {
                       if(msg==true){
                           // $('input[name=\'checkbox\']:checked').each(function () {
                           //     $('input[name=\'checkbox\']:checked=fal')
                           // });
                           self.loadData();
                       }else{
                           self.$message.error('错了哦，操作失败');
                       }
                   }
               });
               // 向数据库添加家具信息，主要添加一个房屋编号和家具编号
               // axios.post("/demo4/house/saveFurniture",this.furnitureForm.houseid,{
               //     // furnitures:ids.toString()
               // })
               //     .then(function (response) {
               //
               //         if (response.data==true){
               //             self.loadData();
               //         }else{
               //             self.$message.error('错了哦，操作失败');
               //         }
               //     })
           },
           resetForm: function (formName) {
               this.$refs[formName].resetFields();
           },
           handleAvatarSuccess:function(res, file) {
               this.imageUrl = URL.createObjectURL(file.raw);
               this.ruleForm.headPicName=file.response.originalFilename;
               this.ruleForm.headPic=file.response.newFileName;
           },
           beforeAvatarUpload:function(file) {
               const isJPG = file.type === 'image/jpeg';
               const isLt2M = file.size / 1024 / 1024 < 2;

               if (!isJPG) {
                   this.$message.error('上传头像图片只能是 JPG 格式!');
               }
               if (!isLt2M) {
                   this.$message.error('上传头像图片大小不能超过 2MB!');
               }
               return isJPG && isLt2M;
           }
       }
   })


</script>

</body>
</html>